<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Bot - Daily Message Creator</title>
    
    <!-- CV Global Favicon Implementation -->
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="256x256" href="/static/favicon/favicon-256x256.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
    <link rel="shortcut icon" href="/static/favicon.ico">
    <meta name="theme-color" content="#00ff88">
    <meta name="msapplication-TileColor" content="#000000">
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/cvglobal-theme.css">
</head>
<body class="cv-bg-dark">

<div class="container-fluid">
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/dashboard">
                <img src="/static/favicon/cv-new-logo-favicon-32px.png" alt="CV Global Logo" class="me-2" style="width: 24px; height: 24px;">
                Daily Message Creator
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/dashboard">
                    <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                </a>
                <a class="nav-link" href="/bots">
                    <i class="fas fa-robot me-1"></i>Bots
                </a>
                <a class="nav-link" href="/logout">
                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                </a>
            </div>
        </div>
    </nav>
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card cv-card">
                <div class="card-header cv-bg-secondary">
                    <h3><i class="fas fa-robot me-2 cv-text-primary"></i>Create New Bot</h3>
                    <p class="text-muted mb-0">Set up a new faith journey chatbot with platform-specific configurations</p>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        {{ form.hidden_tag() }}

                        <!-- Basic Information -->
                        <div class="section-header cv-section-header">
                            <h5><i class="fas fa-info-circle me-2 cv-text-primary"></i>Basic Information</h5>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.name.label(class="form-label") }}
                                {{ form.name(class="form-control" + (" is-invalid" if form.name.errors else "")) }}
                                {% if form.name.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.name.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                {{ form.journey_duration_days.label(class="form-label") }}
                                {{ form.journey_duration_days(class="form-control" + (" is-invalid" if form.journey_duration_days.errors else "")) }}
                                {% if form.journey_duration_days.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.journey_duration_days.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">Number of days for the complete faith journey</div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.delivery_interval_minutes.label(class="form-label") }}
                                {{ form.delivery_interval_minutes(class="form-control" + (" is-invalid" if form.delivery_interval_minutes.errors else "")) }}
                                {% if form.delivery_interval_minutes.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.delivery_interval_minutes.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">{{ form.delivery_interval_minutes.description }}</div>
                            </div>
                            <div class="col-md-6">
                                {{ form.language.label(class="form-label") }}
                                {{ form.language(class="form-select" + (" is-invalid" if form.language.errors else "")) }}
                                {% if form.language.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.language.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">{{ form.language.description }}</div>
                            </div>
                        </div>

                        <div class="mb-4">
                            {{ form.description.label(class="form-label") }}
                            {{ form.description(class="form-control", rows="3") }}
                            <div class="form-text">Optional description of your bot's purpose</div>
                        </div>

                        <!-- Platform Selection -->
                        <div class="section-header cv-section-header">
                            <h5><i class="fas fa-mobile-alt me-2 cv-text-primary"></i>Platform Selection</h5>
                        </div>

                        <div class="mb-4">
                            {{ form.platforms.label(class="form-label") }}
                            <div class="platform-checkboxes">
                                {% for value, label in form.platforms.choices %}
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input platform-checkbox" type="checkbox" name="platforms" value="{{ value }}" id="platform_{{ value }}">
                                    <label class="form-check-label" for="platform_{{ value }}">
                                        <i class="fab fa-{{ 'whatsapp' if value == 'whatsapp' else 'telegram-plane' }} me-2"></i>{{ label }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                            {% if form.platforms.errors %}
                                <div class="text-danger">
                                    {% for error in form.platforms.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- WhatsApp Configuration -->
                        <div id="whatsapp-config" class="platform-config" style="display: none;">
                            <div class="section-header cv-section-header">
                                <h5><i class="fab fa-whatsapp me-2 cv-text-primary"></i>WhatsApp Configuration</h5>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    {{ form.whatsapp_access_token.label(class="form-label") }}
                                    {{ form.whatsapp_access_token(class="form-control", placeholder="Enter WhatsApp Access Token") }}
                                    <div class="form-text">From Meta for Developers</div>
                                </div>
                                <div class="col-md-6">
                                    {{ form.whatsapp_phone_number_id.label(class="form-label") }}
                                    {{ form.whatsapp_phone_number_id(class="form-control", placeholder="Enter Phone Number ID") }}
                                    <div class="form-text">WhatsApp Business Phone Number ID</div>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    {{ form.whatsapp_webhook_url.label(class="form-label") }}
                                    {{ form.whatsapp_webhook_url(class="form-control", placeholder="https://yourapp.replit.app/whatsapp") }}
                                    <div class="form-text">URL where WhatsApp will send webhook notifications</div>
                                </div>
                                <div class="col-md-6">
                                    {{ form.whatsapp_verify_token.label(class="form-label") }}
                                    {{ form.whatsapp_verify_token(class="form-control" + (" is-invalid" if form.whatsapp_verify_token.errors else "")) }}
                                    {% if form.whatsapp_verify_token.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.whatsapp_verify_token.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Token for webhook verification with Meta</div>
                                </div>
                            </div>
                        </div>

                        <!-- Telegram Configuration -->
                        <div id="telegram-config" class="platform-config" style="display: none;">
                            <div class="section-header cv-section-header">
                                <h5><i class="fab fa-telegram-plane me-2 cv-text-primary"></i>Telegram Configuration</h5>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    {{ form.telegram_bot_token.label(class="form-label") }}
                                    {{ form.telegram_bot_token(class="form-control", placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz") }}
                                    <div class="form-text">From @BotFather on Telegram</div>
                                </div>
                                <div class="col-md-6">
                                    {{ form.telegram_webhook_url.label(class="form-label") }}
                                    {{ form.telegram_webhook_url(class="form-control", placeholder="Auto-generated after bot creation", readonly=true) }}
                                    <div class="form-text"><i class="fas fa-magic me-1 text-success"></i>Automatically configured when bot is created</div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Configuration -->
                        <div class="section-header cv-section-header">
                            <h5><i class="fas fa-brain me-2 cv-text-primary"></i>AI Behavior</h5>
                        </div>

                        <!-- Bot Template Selection -->
                        <div class="mb-4">
                            {{ form.bot_template.label(class="form-label") }}
                            {{ form.bot_template(class="form-select" + (" is-invalid" if form.bot_template.errors else ""), id="bot-template-selector") }}
                            {% if form.bot_template.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.bot_template.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">{{ form.bot_template.description }}</div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.journey_duration_days.label(class="form-label") }}
                                {{ form.journey_duration_days(class="form-control" + (" is-invalid" if form.journey_duration_days.errors else "")) }}
                                {% if form.journey_duration_days.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.journey_duration_days.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">Number of days for the faith journey</div>
                            </div>
                        </div>

                        <div class="mb-4">
                            {{ form.ai_prompt.label(class="form-label") }}
                            {{ form.ai_prompt(class="form-control" + (" is-invalid" if form.ai_prompt.errors else ""), rows="5", id="ai-prompt-field") }}
                            {% if form.ai_prompt.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.ai_prompt.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Define how your AI should respond to users. Be specific about tone, approach, and spiritual guidance style.</div>
                        </div>

                        <!-- Command Messages Configuration -->
                        <div class="section-header cv-section-header">
                            <h5><i class="fas fa-comments me-2 cv-text-primary"></i>Command Messages</h5>
                        </div>

                        <div class="mb-3">
                            {{ form.help_message.label(class="form-label") }}
                            {{ form.help_message(class="form-control" + (" is-invalid" if form.help_message.errors else ""), rows="4", id="help_message") }}
                            {% if form.help_message.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.help_message.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Message sent when users type /help or HELP</div>
                        </div>

                        <div class="mb-3">
                            {{ form.stop_message.label(class="form-label") }}
                            {{ form.stop_message(class="form-control" + (" is-invalid" if form.stop_message.errors else ""), rows="4", id="stop_message") }}
                            {% if form.stop_message.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.stop_message.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Message sent when users type /stop or STOP</div>
                        </div>

                        <div class="mb-4">
                            {{ form.human_message.label(class="form-label") }}
                            {{ form.human_message(class="form-control" + (" is-invalid" if form.human_message.errors else ""), rows="4", id="human_message") }}
                            {% if form.human_message.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.human_message.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Message sent when users type /human or HUMAN</div>
                        </div>

                        <!-- AI Content Generation -->
                        <div class="section-header cv-section-header">
                            <h5><i class="fas fa-magic me-2 cv-text-primary"></i>AI Content Generation</h5>
                        </div>

                        <div class="ai-content-section p-3 mb-4" style="background-color: var(--bs-secondary); border-radius: 0.5rem; border: 1px solid var(--bs-border-color);">
                            <div class="form-check form-switch mb-3">
                                {{ form.enable_ai_content_generation(class="form-check-input", id="enableAiContent") }}
                                {{ form.enable_ai_content_generation.label(class="form-check-label", for="enableAiContent") }}
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Enable this to automatically generate content for your journey using AI. Configure the settings below to customize the content.
                                </div>
                            </div>

                            <div id="ai-content-config" style="display: none;">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        {{ form.content_generation_duration.label(class="form-label") }}
                                        {{ form.content_generation_duration(class="form-select") }}
                                        <div class="form-text">Choose how many days of content to generate</div>
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.audience_language.label(class="form-label") }}
                                        {{ form.audience_language(class="form-control") }}
                                        <div class="form-text">{{ form.audience_language.description }}</div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        {{ form.target_audience.label(class="form-label") }}
                                        {{ form.target_audience(class="form-control", placeholder="Young Muslim adults seeking spiritual guidance") }}
                                        <div class="form-text">{{ form.target_audience.description }}</div>
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.audience_age_group.label(class="form-label") }}
                                        {{ form.audience_age_group(class="form-control", placeholder="18-25") }}
                                        <div class="form-text">{{ form.audience_age_group.description }}</div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    {{ form.audience_religion.label(class="form-label") }}
                                    {{ form.audience_religion(class="form-control", placeholder="Islam") }}
                                    <div class="form-text">{{ form.audience_religion.description }}</div>
                                </div>

                                <div class="mb-3">
                                    {{ form.content_generation_prompt.label(class="form-label") }}
                                    {{ form.content_generation_prompt(class="form-control", rows="4", placeholder="Create a gentle, respectful faith journey that introduces Christian concepts...") }}
                                    <div class="form-text">{{ form.content_generation_prompt.description }}</div>
                                </div>

                                <div class="alert alert-info">
                                    <i class="fas fa-lightbulb me-2"></i>
                                    <strong>Content Generation Tips:</strong>
                                    <ul class="mb-0 mt-2">
                                        <li>Be specific about your target audience's background and needs</li>
                                        <li>Describe the tone you want (gentle, encouraging, respectful, etc.)</li>
                                        <li>Mention any specific topics or themes to focus on</li>
                                        <li>Consider cultural sensitivities and religious backgrounds</li>
                                        <li>Content will include daily messages with reflection questions</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between">
                            <a href="/bots" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Cancel
                            </a>
                            {{ form.submit(class="btn cv-btn-primary") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.section-header {
    border-bottom: 2px solid var(--bs-border-color);
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
}

.section-header h5 {
    margin-bottom: 0;
    color: #8B5CF6;
}

.platform-config {
    background-color: var(--bs-secondary);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
    border: 1px solid var(--bs-border-color);
    color: #E5E7EB;
}

.platform-checkboxes {
    padding: 1rem;
    background-color: var(--bs-secondary);
    border-radius: 0.5rem;
    border: 1px solid var(--bs-border-color);
    color: #E5E7EB;
}

.form-check-inline {
    margin-right: 2rem;
}

.form-text {
    color: #A855F7 !important;
}

.form-label {
    color: #E5E7EB !important;
    font-weight: 500;
}

.platform-config .form-text {
    color: #C4B5FD !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const platformCheckboxes = document.querySelectorAll('.platform-checkbox');
    const whatsappConfig = document.getElementById('whatsapp-config');
    const telegramConfig = document.getElementById('telegram-config');
    const enableAiContent = document.getElementById('enableAiContent');
    const aiContentConfig = document.getElementById('ai-content-config');

    // Platform configuration toggle
    platformCheckboxes.forEach(checkbox => {
        // Check initial state on page load
        if (checkbox.checked) {
            if (checkbox.value === 'whatsapp' && whatsappConfig) {
                whatsappConfig.style.display = 'block';
            } else if (checkbox.value === 'telegram' && telegramConfig) {
                telegramConfig.style.display = 'block';
            }
        }
        
        // Listen for changes
        checkbox.addEventListener('change', function() {
            if (this.value === 'whatsapp' && whatsappConfig) {
                whatsappConfig.style.display = this.checked ? 'block' : 'none';
            } else if (this.value === 'telegram' && telegramConfig) {
                telegramConfig.style.display = this.checked ? 'block' : 'none';
            }
        });
    });

    // Bot Template handling
    const templateSelector = document.getElementById('bot-template-selector');
    const aiPromptField = document.getElementById('ai-prompt-field');
    const helpMessageField = document.getElementById('help_message');
    const stopMessageField = document.getElementById('stop_message');
    const humanMessageField = document.getElementById('human_message');
    
    templateSelector.addEventListener('change', function() {
        if (this.value === 'indonesian_muslim') {
            // Indonesian Bang Kris template
            aiPromptField.value = `Kamu adalah Bang Kris, seorang pemandu spiritual Indonesia yang ramah dan berpengalaman. Kamu bertugas membantu orang dari latar belakang Islam untuk menjelajahi spiritualitas dan pembelajaran tentang Isa Al-Masih.

ATURAN BAHASA INDONESIA:
- SELALU gunakan Bahasa Indonesia dalam semua respons
- Gunakan gaya bahasa yang natural dan ramah seperti teman sebaya
- Gunakan sapaan "Assalamualaikum" atau "Halo" untuk memulai percakapan
- Gunakan kata "kamu" bukan "anda" untuk terdengar lebih personal

TERMINOLOGI ISLAM-KRISTEN:
- Gunakan "Isa Al-Masih" atau "Isa al-Masih" untuk Jesus 
- Gunakan "Allah" atau "Allah SWT" untuk God
- Gunakan terminologi yang menghormati kedua tradisi religius
- Hindari jargon Kristen yang mungkin asing (seperti "diselamatkan", "dilahirkan kembali")

PENDEKATAN BUDAYA:
- Hormati latar belakang Islam pengguna
- Bangun jembatan antara kedua tradisi dengan hormat
- Fokus pada kesamaan spiritual (kasih, damai, belas kasihan)
- Jangan pernah mengkritik atau meremehkan Islam
- Tekankan perjalanan spiritual personal, bukan perubahan agama

GAYA PERCAKAPAN:
- Responsif terhadap pertanyaan dan refleksi pengguna
- Berikan jawaban yang bijaksana dan penuh kasih
- Gunakan emoji secara wajar (tidak berlebihan)
- Ajukan pertanyaan follow-up untuk mendorong refleksi
- Berbagi wawasan tentang Isa berdasarkan konteks percakapan

Ingat: Kamu adalah teman spiritual yang mendampingi, bukan pendakwah yang memaksa.`;

            helpMessageField.value = `ü§ù Perintah yang tersedia:

üìñ START - Mulai atau mengulang bot
‚èπÔ∏è STOP - Berhenti dari bot 
‚ùì HELP - Menampilkan menu help
üë§ HUMAN - Ngobrol sama manusia

Aku disini untuk menuntun kamu dalam perjalanan spiritual, kamu bisa bertanya tentang pertanyaan iman atau membagikan pemikiran kamu.`;

            stopMessageField.value = `Kamu telah berhenti dari perjalanan spiritual Bang Kris. Kalau mau mulai lagi, tinggal kirim START kapan aja. Damai sejahtera bersamamu. üôè`;

            humanMessageField.value = `ü§ù Permintaan Chat dengan Manusia

Terima kasih sudah menghubungi! Tim kami akan segera terhubung dengan Anda. Percakapan ini sudah ditandai sebagai prioritas untuk respon manusia.

Sementara menunggu, ketahui bahwa Anda berharga dan perjalanan spiritual Anda penting. Silakan berbagi apa yang ada di hati Anda. üôè`;

        } else if (this.value === 'english_general') {
            // English general template
            aiPromptField.value = `You are a compassionate spiritual guide helping people explore their faith journey and learn about Jesus Christ. Your approach should be:

COMMUNICATION STYLE:
- Warm, friendly, and non-judgmental
- Use conversational, everyday language
- Be patient and understanding of different backgrounds
- Encourage questions and honest exploration

THEOLOGICAL APPROACH:
- Focus on God's love and grace through Jesus Christ
- Present biblical truths with gentleness and respect
- Bridge cultural and religious differences with wisdom
- Avoid confrontational or pushy evangelism
- Emphasize personal relationship with Jesus

CONVERSATION GUIDELINES:
- Listen actively to user's questions and reflections
- Provide thoughtful, biblically-grounded responses
- Ask follow-up questions to encourage deeper thinking
- Share appropriate Bible verses when relevant
- Respect the user's pace and spiritual journey

Remember: You are a guide and companion, not a preacher. Meet people where they are and help them take their next step toward Jesus.`;

            helpMessageField.value = `ü§ù Available Commands:

üìñ START - Begin or restart your faith journey
‚èπÔ∏è STOP - Pause the journey
‚ùì HELP - Show this help message
üë§ HUMAN - Connect with a human counselor

I'm here to guide you through a meaningful spiritual journey. Feel free to ask questions or share your thoughts anytime!`;

            stopMessageField.value = `‚è∏Ô∏è Your faith journey has been paused.

Take your time whenever you're ready to continue. Send START to resume your journey, or HUMAN if you'd like to speak with someone.

Remember, this is your personal space for spiritual exploration. There's no pressure - go at your own pace. üôè`;

            humanMessageField.value = `üë§ Human Support Requested

I've flagged your conversation for our human counselors who will respond as soon as possible. They're trained in spiritual guidance and are here to support you.

In the meantime, feel free to continue sharing your thoughts or questions. Everything you share is treated with care and confidentiality. üíù`;
        }
        // For 'custom', leave fields as they are for user to customize
    });

    // AI Content Generation toggle
    if (enableAiContent) {
        enableAiContent.addEventListener('change', function() {
            aiContentConfig.style.display = this.checked ? 'block' : 'none';
            
            // Auto-sync journey duration when AI content is enabled
            if (this.checked) {
                const contentDuration = document.getElementById('content_generation_duration');
                const journeyDuration = document.getElementById('journey_duration_days');
                
                // Set journey duration to match content generation duration
                journeyDuration.value = contentDuration.value;
                
                // Keep them synced
                contentDuration.addEventListener('change', function() {
                    journeyDuration.value = this.value;
                });
            }
        });
    }

    // Show initial state
    if (enableAiContent && enableAiContent.checked) {
        aiContentConfig.style.display = 'block';
    }
});
</script>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>